name: ⚙️ Build Binaries

on:
  workflow_dispatch:
  workflow_call:

jobs:
  build-artifacts:
    strategy:
      fail-fast: true
      matrix:
        target:
          - os: linux
            triple: x86_64-linux-musl
            name: linux
            cpu: amd64
            nim_cpu: amd64
            nimble_cpu: amd64
            archive_format: tgz
          - os: linux
            triple: i686-linux-musl
            name: linux
            cpu: i686
            nim_cpu: i386
            nimble_cpu: amd64
            archive_format: tgz
          - os: linux
            triple: aarch64-linux-musl
            name: linux
            cpu: arm64
            nim_cpu: arm64
            nimble_cpu: amd64
            archive_format: tgz
          - os: macos
            triple: x86_64-apple-darwin14
            name: macos
            cpu: amd64
            nim_cpu: amd64
            nimble_cpu: amd64
            archive_format: zip
          - os: macos
            triple: aarch64-apple-darwin14
            name: macos
            cpu: arm64
            nim_cpu: arm64
            nimble_cpu: amd64
            archive_format: zip
          # - os: windows
          #   triple: x86_64-w64-mingw32
          #   name: windows
          #   cpu: amd64
          #   nim_cpu: amd64
          #   nimble_cpu: amd64
          #   archive_format: zip
          # - os: windows
          #   triple: i686-w32-mingw32
          #   name: windows
          #   cpu: i686
          #   nim_cpu: i386
          #   nimble_cpu: amd64
          #   archive_format: zip
          #
        include:
          - target:
              os: linux
            builder: ubuntu-20.04
          - target:
              os: macos
            builder: macos-11
          # - target:
          #     os: windows
          #   builder: windows-2019

    uses: daylinmorgan/actions/.github/workflows/build-nim-binaries.yml@main
    with:
      module: todo
      binDir: bin
      os: ${{ matrix.target.os }}
      triple: ${{ matrix.target.triple }}
      name: ${{ matrix.target.name }}
      cpu: ${{ matrix.target.cpu }}
      nim_cpu: ${{ matrix.target.nim_cpu }}
      nimble_cpu: ${{ matrix.target.nimble_cpu }}
      archive_format: ${{ matrix.target.archive_format }}
      builder: ${{ matrix.builder }}



